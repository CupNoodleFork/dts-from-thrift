import { handleComments } from './handleComments';
import { parse } from './@creditkarma/thrift-parser';
import {
  ThriftDocument,
  ThriftErrors,
  SyntaxType
} from '@creditkarma/thrift-parser';

const ast = parse(
  `
  /* xxxxxx */
  // comment0
  struct Collection {
    // comment1
    // comment2
    1: optional BizType biz_type (source = 'query',   key = 'bizType'), // comment3
    3: optional pack_goods.ExtensiveGoodsItem sku_collection,
}  // comment4
service CollectService {
  Collection Collect(1:i32 req)  (method = 'GET',  uri = '/api/collect'),/* zzzzz */ // comment6
}
// comment5
  `
);

if (isThritDocument(ast)) {
  if (JSON.stringify(handleComments(ast)) !== JSON.stringify({"type":"ThriftDocument","body":[{"type":"ConstDefinition","name":{"type":"Identifier","value":"liuqi","loc":{"start":{"line":15,"column":11,"index":394},"end":{"line":15,"column":16,"index":399}}},"fieldType":{"type":"I32Keyword","loc":{"start":{"line":15,"column":7,"index":390},"end":{"line":15,"column":10,"index":393}}},"initializer":{"type":"IntConstant","value":{"type":"IntegerLiteral","value":"1995","loc":{"start":{"line":15,"column":17,"index":400},"end":{"line":15,"column":21,"index":404}}},"loc":{"start":{"line":15,"column":17,"index":400},"end":{"line":15,"column":21,"index":404}}},"comments":[{"type":"CommentBlock","value":["zzzzz"],"loc":{"start":{"line":11,"column":74,"index":343},"end":{"line":11,"column":85,"index":354}}},{"type":"CommentLine","value":"comment6","loc":{"start":{"line":11,"column":86,"index":355},"end":{"line":11,"column":97,"index":366}}},{"type":"CommentLine","value":"comment5","loc":{"start":{"line":13,"column":1,"index":369},"end":{"line":13,"column":12,"index":380}}}],"loc":{"start":{"line":15,"column":1,"index":384},"end":{"line":15,"column":21,"index":404}},"commentsBefore":[{"type":"CommentLine","value":"comment5","loc":{"start":{"line":13,"column":1,"index":369},"end":{"line":13,"column":12,"index":380}}}],"commentsAfter":[]},{"type":"StructDefinition","name":{"type":"Identifier","value":"Collection","loc":{"start":{"line":4,"column":10,"index":39},"end":{"line":4,"column":20,"index":49}}},"fields":[{"type":"FieldDefinition","name":{"type":"Identifier","value":"biz_type","loc":{"start":{"line":7,"column":25,"index":108},"end":{"line":7,"column":33,"index":116}}},"fieldID":{"type":"FieldID","value":1,"loc":{"start":{"line":7,"column":5,"index":88},"end":{"line":7,"column":7,"index":90}}},"fieldType":{"type":"Identifier","value":"BizType","loc":{"start":{"line":7,"column":17,"index":100},"end":{"line":7,"column":24,"index":107}}},"requiredness":"optional","defaultValue":null,"comments":[{"type":"CommentLine","value":"comment1","loc":{"start":{"line":5,"column":5,"index":56},"end":{"line":5,"column":16,"index":67}}},{"type":"CommentLine","value":"comment2","loc":{"start":{"line":6,"column":5,"index":72},"end":{"line":6,"column":16,"index":83}}}],"annotations":{"annotations":[{"type":"Annotation","name":{"type":"Identifier","value":"source","loc":{"start":{"line":7,"column":35,"index":118},"end":{"line":7,"column":41,"index":124}}},"value":{"type":"StringLiteral","value":"query","loc":{"start":{"line":7,"column":44,"index":127},"end":{"line":7,"column":51,"index":134}}},"loc":{"start":{"line":7,"column":35,"index":118},"end":{"line":7,"column":51,"index":134}}},{"type":"Annotation","name":{"type":"Identifier","value":"key","loc":{"start":{"line":7,"column":55,"index":138},"end":{"line":7,"column":58,"index":141}}},"value":{"type":"StringLiteral","value":"bizType","loc":{"start":{"line":7,"column":61,"index":144},"end":{"line":7,"column":70,"index":153}}},"loc":{"start":{"line":7,"column":55,"index":138},"end":{"line":7,"column":70,"index":153}}}],"type":"Annotations","loc":{"start":{"line":7,"column":34,"index":117},"end":{"line":7,"column":71,"index":154}}},"loc":{"start":{"line":7,"column":5,"index":88},"end":{"line":7,"column":72,"index":155}},"commentsBefore":[{"type":"CommentLine","value":"comment1","loc":{"start":{"line":5,"column":5,"index":56},"end":{"line":5,"column":16,"index":67}}},{"type":"CommentLine","value":"comment2","loc":{"start":{"line":6,"column":5,"index":72},"end":{"line":6,"column":16,"index":83}}}],"commentsAfter":[{"type":"CommentLine","value":"comment3","loc":{"start":{"line":7,"column":73,"index":156},"end":{"line":7,"column":84,"index":167}}}]},{"type":"FieldDefinition","name":{"type":"Identifier","value":"sku_collection","loc":{"start":{"line":8,"column":47,"index":214},"end":{"line":8,"column":61,"index":228}}},"fieldID":{"type":"FieldID","value":3,"loc":{"start":{"line":8,"column":5,"index":172},"end":{"line":8,"column":7,"index":174}}},"fieldType":{"type":"Identifier","value":"pack_goods.ExtensiveGoodsItem","loc":{"start":{"line":8,"column":17,"index":184},"end":{"line":8,"column":46,"index":213}}},"requiredness":"optional","defaultValue":null,"comments":[{"type":"CommentLine","value":"comment3","loc":{"start":{"line":7,"column":73,"index":156},"end":{"line":7,"column":84,"index":167}}}],"loc":{"start":{"line":8,"column":5,"index":172},"end":{"line":8,"column":62,"index":229}},"commentsBefore":[],"commentsAfter":[]}],"comments":[{"type":"CommentBlock","value":["xxxxxx"],"loc":{"start":{"line":2,"column":3,"index":3},"end":{"line":2,"column":15,"index":15}}},{"type":"CommentLine","value":"comment0","loc":{"start":{"line":3,"column":3,"index":18},"end":{"line":3,"column":14,"index":29}}}],"loc":{"start":{"line":4,"column":3,"index":32},"end":{"line":9,"column":2,"index":231}},"commentsBefore":[{"type":"CommentBlock","value":["xxxxxx"],"loc":{"start":{"line":2,"column":3,"index":3},"end":{"line":2,"column":15,"index":15}}},{"type":"CommentLine","value":"comment0","loc":{"start":{"line":3,"column":3,"index":18},"end":{"line":3,"column":14,"index":29}}}],"commentsAfter":[{"type":"CommentLine","value":"comment4","loc":{"start":{"line":9,"column":4,"index":233},"end":{"line":9,"column":15,"index":244}}}]},{"type":"ServiceDefinition","name":{"type":"Identifier","value":"CollectService","loc":{"start":{"line":10,"column":9,"index":253},"end":{"line":10,"column":23,"index":267}}},"extends":null,"functions":[{"type":"FunctionDefinition","name":{"type":"Identifier","value":"Collect","loc":{"start":{"line":11,"column":14,"index":283},"end":{"line":11,"column":21,"index":290}}},"returnType":{"type":"Identifier","value":"Collection","loc":{"start":{"line":11,"column":3,"index":272},"end":{"line":11,"column":13,"index":282}}},"fields":[{"type":"FieldDefinition","name":{"type":"Identifier","value":"req","loc":{"start":{"line":11,"column":28,"index":297},"end":{"line":11,"column":31,"index":300}}},"fieldID":{"type":"FieldID","value":1,"loc":{"start":{"line":11,"column":22,"index":291},"end":{"line":11,"column":24,"index":293}}},"fieldType":{"type":"I32Keyword","loc":{"start":{"line":11,"column":24,"index":293},"end":{"line":11,"column":27,"index":296}}},"requiredness":null,"defaultValue":null,"comments":[],"loc":{"start":{"line":11,"column":22,"index":291},"end":{"line":11,"column":31,"index":300}}}],"throws":[],"annotations":{"annotations":[{"type":"Annotation","name":{"type":"Identifier","value":"method","loc":{"start":{"line":11,"column":35,"index":304},"end":{"line":11,"column":41,"index":310}}},"value":{"type":"StringLiteral","value":"GET","loc":{"start":{"line":11,"column":44,"index":313},"end":{"line":11,"column":49,"index":318}}},"loc":{"start":{"line":11,"column":35,"index":304},"end":{"line":11,"column":49,"index":318}}},{"type":"Annotation","name":{"type":"Identifier","value":"uri","loc":{"start":{"line":11,"column":52,"index":321},"end":{"line":11,"column":55,"index":324}}},"value":{"type":"StringLiteral","value":"/api/collect","loc":{"start":{"line":11,"column":58,"index":327},"end":{"line":11,"column":72,"index":341}}},"loc":{"start":{"line":11,"column":52,"index":321},"end":{"line":11,"column":72,"index":341}}}],"type":"Annotations","loc":{"start":{"line":11,"column":34,"index":303},"end":{"line":11,"column":73,"index":342}}},"comments":[],"oneway":false,"modifiers":[],"loc":{"start":{"line":11,"column":3,"index":272},"end":{"line":11,"column":74,"index":343}},"commentsBefore":[],"commentsAfter":[{"type":"CommentBlock","value":["zzzzz"],"loc":{"start":{"line":11,"column":74,"index":343},"end":{"line":11,"column":85,"index":354}}},{"type":"CommentLine","value":"comment6","loc":{"start":{"line":11,"column":86,"index":355},"end":{"line":11,"column":97,"index":366}}}]}],"comments":[{"type":"CommentLine","value":"comment4","loc":{"start":{"line":9,"column":4,"index":233},"end":{"line":9,"column":15,"index":244}}}],"loc":{"start":{"line":10,"column":1,"index":245},"end":{"line":12,"column":2,"index":368}},"commentsBefore":[],"commentsAfter":[]}]}
  )) {
    throw new Error('hanle comments error');
}
}

function isThritDocument(
  ast: ThriftDocument | ThriftErrors
): ast is ThriftDocument {
  return ast.type === SyntaxType.ThriftDocument;
}
